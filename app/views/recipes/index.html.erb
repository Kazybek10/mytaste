<p style="color: green"><%= notice %></p>

<% content_for :stylesheets do %>
  <%= stylesheet_link_tag "background", "index", "data-turbo-track": "reload" %>
<% end %>

<div class="background-video">
  <video autoplay loop muted playsinline id="bg-video">
    <source src="<%= asset_path('recipes.mp4') %>" type="video/mp4">
  </video>
</div>

<div class="header">
  <h1>My Recipes</h1>
  <%= link_to "New Recipe", new_recipe_path, class: "new-resource-link" %>
</div>

<div class="search-sort-container">
  <div class="search-bar">
    <%= form_with(url: recipes_path, method: :get, local: true) do %>
      <%= text_field_tag :query, params[:query], placeholder: "Search recipes by title...", class: "search-input" %>
      <%= submit_tag "Search", class: "search-button" %>
    <% end %>
  </div>
  <div class="sort-links">
    <span>Sort by:</span>
    <%= link_to "Title", recipes_path(sort: "title", query: params[:query]), class: "sort-link" %>
    <%= link_to "Date", recipes_path(sort: "created_at", query: params[:query]), class: "sort-link" %>
  </div>
</div>

<div id="recipes" class="resource-container">
  <% if @recipes.empty? %>
    <p class="no-results">No recipes found.</p>
  <% else %>
    <% @recipes.each do |recipe| %>
      <div class="resource-card">
        <%= link_to recipe do %>
          <div class="card-image">
            <% if recipe.cover_image.attached? && recipe.cover_image.image? %>
              <% begin %>
                <%= image_tag url_for(recipe.cover_image.variant(resize_to_limit: [400, 600])), class: "resource-image" %>
              <% rescue StandardError %>
                <div class="image-placeholder">
                  <span class="placeholder-text">No Image</span>
                </div>
              <% end %>
            <% else %>
              <div class="image-placeholder">
                <span class="placeholder-text">No Image</span>
              </div>
            <% end %>
          </div>
          <div class="card-body">
            <h2 class="card-title"><%= recipe.title %></h2>
            <p class="card-text"><strong>Ingredients:</strong> <%= truncate(recipe.ingredients, length: 100) %></p>
            <p class="card-text"><strong>Instructions:</strong> <%= truncate(recipe.instructions, length: 100) %></p>
          </div>
        <% end %>
      </div>
    <% end %>
  <% end %>
</div>

<div class="pagy-container">
  <% if @pagy.pages > 1 %>
    <%== pagy_nav(@pagy) %>
  <% end %>
</div>
</div> 
